<div class="w-full max-w-md bg-white p-6 rounded-lg">
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-xl font-semibold flex items-center">
            <i data-lucide="upload" class="mr-2 text-blue-500"></i>
            Upload Book
        </h2>
        <button onclick="closeUploadModal()" class="text-gray-500 hover:text-gray-700">
            <i data-lucide="x"></i>
        </button>
    </div>
    <form id="upload-form" enctype="multipart/form-data">
        <div class="flex items-center justify-center w-full mb-4">
            <label for="dropzone-file" class="flex flex-col items-center justify-center w-full h-64 border-2 border-blue-300 border-dashed rounded-lg cursor-pointer bg-gray-50 hover:bg-gray-100">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                    <i data-lucide="upload" class="w-10 h-10 mb-3 text-blue-500"></i>
                    <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                    <p class="text-xs text-gray-500">TXT, FB2 (MAX. 100MB)</p>
                </div>
                <input id="dropzone-file" type="file" class="hidden" name="file" accept=".txt,.fb2" required />
            </label>
        </div>
        <div class="mb-4">
            <label for="book-title" class="block text-sm font-medium text-gray-700 mb-1">
                Book Title
            </label>
            <div class="flex items-center">
                <i data-lucide="file-text" class="text-blue-500 mr-2"></i>
                <input type="text" id="book-title" name="title" class="w-full p-2 border rounded-md" required />
            </div>
        </div>
        <div class="flex justify-end">
            <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                Upload
            </button>
        </div>
    </form>
</div>

<script>
function closeUploadModal() {
    document.getElementById('upload-modal').classList.add('hidden');
}

document.getElementById('upload-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    fetch('/upload_book', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            closeUploadModal();
            location.reload(); // Refresh the page to show the new book
        } else {
            alert('Error uploading book: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while uploading the book.');
    });
});

document.getElementById('dropzone-file').addEventListener('change', function(e) {
    if (this.files[0]) {
        document.getElementById('book-title').value = this.files[0].name.split('.').slice(0, -1).join('.');
    }
});
</script>

